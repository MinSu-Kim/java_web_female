<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.yi.java_web_female.dao.CustomerMapper">
	<resultMap type="Customer" id="ResultCustom">
		<id column="code" property="code" />
		<result column="Id" property="id"/>
		<result column="passwd" property="passwd"/>
		<result column="Name" property="name"/>
		<result column="address" property="address"/>
		<result column="phone" property="phone"/>
		<result column="dob" property="dob"/>
		<result column="email" property="email"/>
		<result column="emp_code" property="empCode.code"/>
		<result column="license" property="license"/>
		<result column="grade_code" property="gradeCode.code"/>
		<result column="rent_cnt" property="rentCnt"/>
	</resultMap>
	
	<select id="selectCustomerByName" parameterType="Customer" resultMap="ResultCustom">
		select code, Id, passwd, Name, address, phone, dob, email, emp_code, license, grade_code, rent_cnt 
		from customer 
		where name = #{name}
	</select>
	
	<resultMap type="Customer" id="ResultCustomExtend" extends="ResultCustom">
		<collection property="events" resultMap="kr.or.yi.java_web_female.dao.CustomEventMapper.resultCustomEvent"/>
	</resultMap>
	
	
	
	<select id="selectCustomerByCode" parameterType="Customer" resultMap="ResultCustomExtend">
		select c.code, Id, passwd, c.Name, address, phone, dob, email, emp_code, license, grade_code, rent_cnt,
	           event_code, custom_code, is_use, e.code, e.name, rate 
		from customer c join custom_event ce on c.code = ce.custom_code join event e on ce.event_code = e.code
		where c.code = #{code};
	</select>
	
	<select id="selectCustomerByAll" resultMap="ResultCustom">
		select code, Id, password(#{passwd}), Name, address, phone, dob, email, emp_code, license, grade_code, rent_cnt 
		from customer 
	</select>
	
	<select id="selectCustomerById" resultMap="ResultCustom">
		select code, Id, password(#{passwd}), Name, address, phone, dob, email, emp_code, license, grade_code, rent_cnt
		from customer
		where Id = #{id}
	</select>
		
	<insert id="insertCustomer" parameterType="Customer">
		insert into customer(code, Id, passwd, Name, address, phone, dob, email, emp_code, license, grade_code, rent_cnt  )
		values(#{code}, #{id}, password(#{passwd}), #{name}, #{address}, #{phone}, #{dob}, #{email},#{empCode.code}, #{license}, #{gradeCode.code}, #{rentCnt})
	</insert>
	
	<select id="nextCustomerCode" resultType="java.lang.Integer">
		select count(*)+1 from customer;
	</select>
	<select id="nextCode" resultType="int">
		select count(*)+1 from customer;
	</select>
	
	<select id="selectCustomerByPw" resultMap="ResultCustom">
		select code, Id, Name, address, phone, dob, email, emp_code, license, grade_code, rent_cnt
		from customer
		where Id = #{id} and passwd = password(#{passwd});
	</select>
	
	<!-- update -->
	<!--  <update id="updateCustomer" parameterType="Customer">
		update customer 
		set code=#{code}, Id=#{id}, passwd=password(#{passwd}), name=#{name}, address=#{address}, phone=#{phone}, dob=#{dob}, email=#{email}, license=#{license}, grade_code=#{gradeCode}, rent_cnt=#{rentCnt}
		where code=#{code}
	</update>  -->
	
	<!-- delete -->
	<delete id="deleteCustomer" parameterType="Customer">

		delete from customer
		where code=#{code}
		
	</delete> 

</mapper>